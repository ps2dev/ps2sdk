<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PS2SDK: PS2SDK - KERNEL LIBRARY</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">PS2SDK
   </div>
   <div id="projectbrief">PS2 Homebrew Libraries</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_ee_2kernel_2_r_e_a_d_m_e.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">PS2SDK - KERNEL LIBRARY</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>SUMMARY</h1>
<p>This folder creates the <code>libkernel.a</code> library, which contains all the references to the BIOS functionality embedded in the hardware of every single PS2.</p>
<p>Probably you've heard, that the <code>PS2 BIOS</code> is full of bugs, which totally accurate, however, these bugs aren't blocker you still could execute some program (with limited functionality) without any problem.</p>
<h1>SOLVING BIOS ISSUES</h1>
<p>In order to fix all these issues, we're patching the problematic functions by putting some wrappers in the middle before calling the actual BIOS function.</p>
<p>Some of these wrappers are set during the initialization process of the application <code>_InitSys</code> function. Additionally, we also use <code>_InitSys</code> to initialize some other functionality that the user may need.</p>
<h1>CONSEQUENCES</h1>
<p>All these functions are set during the initialization process of every single binary, this implies unfortunately having a bigger size binary.</p>
<p>Some apps require to have really tiny sizes, and also you may want to don't patch these BIOS functions, therefore we are offering the possibility to disable the functions called during the <code>_InitSys</code> function.</p>
<p>Let's first take a look at the current <code>InitSys</code> method:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> _InitSys(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    StartTimerSystemTime();</div>
<div class="line">    InitTimerAlarm();</div>
<div class="line">    InitAlarm();</div>
<div class="line">    InitThread();</div>
<div class="line">    InitExecPS2();</div>
<div class="line">    InitTLBFunctions();</div>
<div class="line">}</div>
</div><!-- fragment --><p>The nature of the functions called can be split into 2 different sections:</p>
<ol type="1">
<li>Patched functionality <div class="fragment"><div class="line">InitAlarm();</div>
<div class="line">InitThread();</div>
<div class="line">InitExecPS2();</div>
<div class="line">InitTLBFunctions();</div>
</div><!-- fragment --></li>
<li>Additional timer utils <div class="fragment"><div class="line">StartTimerSystemTime();</div>
<div class="line">InitTimerAlarm();</div>
</div><!-- fragment --></li>
</ol>
<h1>NO PATCHED BINARIES AND/OR TINY BINARIES</h1>
<p>On the <code><a class="el" href="kernel_8h.html">kernel.h</a></code> file at the very end, we have a section where we defined some <code>macros</code> for making it super easy the disable these functions.</p>
<p>Let's put an example of how to disable the patched functionality:</p>
<div class="fragment"><div class="line">.....</div>
<div class="line">#include &lt;kernel.h&gt;</div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="stdio_8h.html">stdio.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// With this line we disabled the patched functionalities</span></div>
<div class="line">DISABLE_PATCHED_FUNCTIONS();</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">    printf(<span class="stringliteral">&quot;Hello world!\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="astdio_8h_html"><div class="ttname"><a href="stdio_8h.html">stdio.h</a></div></div>
</div><!-- fragment --><p>Let's put another example where we disable the extra timer functionality:</p>
<div class="fragment"><div class="line">.....</div>
<div class="line">#include &lt;kernel.h&gt;</div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="stdio_8h.html">stdio.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// With this line we disabled the extra functionalities for timers</span></div>
<div class="line">DISABLE_EXTRA_TIMERS_FUNCTIONS();</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">    printf(<span class="stringliteral">&quot;Hello world!\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Therefore we can combine both:</p>
<div class="fragment"><div class="line">.....</div>
<div class="line">#include &lt;kernel.h&gt;</div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="stdio_8h.html">stdio.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// With this line we disabled the patched functionalities</span></div>
<div class="line">DISABLE_PATCHED_FUNCTIONS();</div>
<div class="line"><span class="comment">// With this line we disabled the extra functionalities for timers</span></div>
<div class="line">DISABLE_EXTRA_TIMERS_FUNCTIONS();</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">    printf(<span class="stringliteral">&quot;Hello world!\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><h1>HOW IS THIS WORKING?</h1>
<p>It honestly is quite easy. All these functions that we may want to disable are defined as <code><a class="el" href="libgs_8h.html#a750ff38b5bb9d91851328c0bc599518f">__attribute__((weak))</a></code>, so it means that if a "strong" implementation is defined, they will override. For this reason, the macros defined in the <code><a class="el" href="kernel_8h.html">kernel.h</a></code> are helpers that either does dummy implementations or bypass the patched wrappers. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sat Oct 11 2025 03:29:56 for PS2SDK by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
